<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alt Steps & 2nd Tradition</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <h1>Alternative Steps and 2nd Tradition</h1>

  <!-- Navigation -->
  <div id="nav">
    <h3>Philosophies</h3>
    <div id="nav-links">Loading...</div>
  </div>

  <!-- Steps Content -->
  <div id="steps-container">Loading...</div>

  <script>
    async function loadPhilosophies() {
      const nav = document.getElementById('nav-links');
      const container = document.getElementById('steps-container');

      nav.innerHTML = '';
      container.innerHTML = '';

      try {
        // Fetch the altsteps.json file
        const response = await fetch('../data/altsteps.json');
        if (!response.ok) throw new Error('Failed to load altsteps.json');

        const philosophies = await response.json();

        // Populate navigation links and content
        philosophies.forEach((file) => {
          // Infer title from filename if no explicit title is provided
          const inferredTitle = file.filename
            .replace(/_/g, ' ') // Replace underscores with spaces
            .replace(/\.json$/i, ''); // Remove the .json extension

          // Create navigation link
          const navLink = document.createElement('a');
          navLink.textContent = inferredTitle;
          navLink.href = `#${inferredTitle.replace(/\s+/g, '-').toLowerCase()}`;
          navLink.onclick = async (e) => {
            e.preventDefault();
            await loadDetails(file, inferredTitle);
          };
          nav.appendChild(navLink);
        });
      } catch (error) {
        nav.textContent = 'Error loading philosophies.';
        console.error(error);
      }
    }

    async function loadDetails(file, inferredTitle) {
      const container = document.getElementById('steps-container');
      container.innerHTML = 'Loading...';

      try {
        // Fetch individual philosophy details
        const response = await fetch(`../philosophies/${file.filename}`);
        if (!response.ok) throw new Error(`Failed to load ${file.filename}`);

        const data = await response.json();

        // Extract the steps from the nested key dynamically
        const stepsKey = Object.keys(data).find(key => Array.isArray(data[key]));
        const steps = stepsKey ? data[stepsKey] : [];

        // Render philosophy details
        container.innerHTML = `
          <div class="step-group">
            <h2>${stepsKey || inferredTitle}</h2>
            <p><strong>Source:</strong> ${data.source || 'Unknown'}</p>
            <ul class="steps-list">
              ${steps.map(step => `<li>${step}</li>`).join('')}
            </ul>
            ${
              data.second_tradition
                ? `<p><strong>Second Tradition:</strong> ${data.second_tradition}</p>`
                : ''
            }
          </div>
        `;
      } catch (error) {
        container.innerHTML = 'Error loading details.';
        console.error(error);
      }
    }

    loadPhilosophies();
  </script>
</body>
</html>

